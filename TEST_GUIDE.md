# 점심 서비스 테스트 가이드

## 아키텍처

- CRUD(장소·설정·비밀번호·이미지 등): 프론트엔드 → **Apps Script** 직접 호출
- 외부 API(검색·지오코딩·정적 지도): 프론트엔드 → **server.js** (search-place, geocode-address, static-map)

테스트 시 `APPS_SCRIPT_URL`이 올바르게 설정되어 있어야 장소 목록·등록·수정·삭제·비밀번호 검증이 동작합니다.

## 배포 순서

### 1단계: Apps Script 배포
**방법**: GitHub Actions 자동 배포 (lunch-service 리포지토리)
- `apps-script-template.js` 파일이 변경되면 자동으로 배포됨
- 수동 배포: GitHub Actions에서 "Deploy Apps Script" 워크플로우 수동 실행
- 확인: https://github.com/Kminer2053/lunch-service/actions

**확인 사항**:
- GitHub Actions 워크플로우 성공 여부 확인
- Apps Script 편집기에서 코드 변경사항 확인
- Apps Script 실행 로그에서 디버깅 메시지 확인 가능 여부 확인

### 2단계: 백엔드 배포 (Render)
**방법**: Render 자동 배포 또는 수동 재배포
- `server.js` 파일 변경사항이 자동으로 배포됨
- 수동 재배포: Render 대시보드에서 "Manual Deploy" 실행

**확인 사항**:
- Render 배포 로그에서 에러 없이 빌드 완료 확인
- 서버가 정상적으로 시작되었는지 확인
- 환경변수 설정 확인 (점심 서비스는 외부 API용만: `NAVER_*`, `NCP_*`, `TMAP_*`)

### 3단계: 프론트엔드 배포 (Vercel)
**방법**: Vercel 자동 배포 또는 수동 배포
- `lunch-service` 폴더의 변경사항이 자동으로 배포됨
- 수동 배포: Vercel CLI 또는 대시보드에서 배포

**확인 사항**:
- Vercel 빌드 로그에서 에러 없이 빌드 완료 확인
- 배포된 URL 접속 테스트
- 브라우저 콘솔에서 에러 없음 확인

## 테스트 전 준비사항

1. 브라우저 개발자 도구 열기 (F12)
2. 콘솔 탭과 네트워크 탭 활성화
3. Apps Script 편집기에서 실행 로그 확인 준비
4. 세션 스토리지 초기화 (필요시): `sessionStorage.clear()`

## 상세 테스트 계획

### 테스트 1: 태그 입력 중복 생성 버그 수정 확인

**목적**: "가정식백반" 입력 시 "#가정식백반"과 "#반" 두 개의 태그가 생성되는 버그 수정 확인

**절차**:
1. 등록 탭 클릭
2. 비밀번호 입력 후 STEP2 화면으로 이동
3. 태그 입력 필드에 "가정식백반" 입력
4. Enter 키 누름

**예상 결과**:
- "#가정식백반" 태그 하나만 생성됨
- "#반" 태그는 생성되지 않음
- 콘솔에 "[addTag] 중복 실행 방지" 메시지가 나타나지 않음 (정상 동작)

**확인 사항**:
- 태그가 정확히 하나만 생성되는지
- 입력 필드가 비워지는지
- 콘솔에 에러가 없는지

### 테스트 2: 비밀번호 모달 표시 확인

**목적**: 등록 탭 클릭 시 비밀번호 모달이 정상적으로 표시되는지 확인

**절차**:
1. 세션 스토리지 초기화 (브라우저 콘솔에서 `sessionStorage.clear()` 실행)
2. 등록 탭 클릭

**예상 결과**:
- 비밀번호 모달이 화면 중앙에 표시됨
- 모달 배경이 반투명하게 표시됨
- 비밀번호 입력 필드에 포커스가 자동으로 이동함
- 취소/확인 버튼이 정상적으로 표시됨

**확인 사항**:
- 모달이 즉시 표시되는지 (지연 없음)
- z-index가 올바르게 설정되어 다른 요소 위에 표시되는지
- 콘솔에 에러가 없는지

### 테스트 3: 비밀번호 검증 실패 처리 확인

**목적**: 잘못된 비밀번호 입력 시 모달이 닫히고 이전 화면으로 복귀하는지 확인

**절차**:
1. 등록 탭 클릭 (비밀번호 모달 표시)
2. 잘못된 비밀번호 입력 (예: "wrongpassword")
3. 확인 버튼 클릭

**예상 결과**:
- 모달이 닫힘
- 이전 탭(추천 또는 목록)으로 복귀
- 토스트 메시지 표시: "올바른 비밀번호를 입력해주세요."
- 등록 탭으로 이동하지 않음

**확인 사항**:
- 모달이 완전히 닫히는지
- 올바른 탭이 활성화되는지
- 에러 메시지가 표시되는지

### 테스트 4: 이미지 업로드 기능 확인

**목적**: 이미지 업로드가 정상적으로 작동하고 "알 수 없는 엔드포인트" 에러가 발생하지 않는지 확인

**절차**:
1. 등록 탭 → 비밀번호 입력 → STEP2
2. 장소 정보 입력 (이름, 주소 등)
3. 이미지 선택 버튼 클릭하여 이미지 파일 선택
4. 이미지 미리보기 확인
5. 등록 완료 버튼 클릭

**예상 결과**:
- 이미지가 정상적으로 업로드됨
- 등록 완료 메시지 표시
- 목록 탭에서 이미지가 표시됨
- 콘솔에 "알 수 없는 엔드포인트" 에러가 없음

**확인 사항**:
- 네트워크 탭에서 `/lunch/upload-image` 요청이 성공(200)하는지
- Apps Script 실행 로그에서 "upload-image" 경로가 정상적으로 처리되는지
- 이미지 URL이 정상적으로 반환되는지

### 테스트 5: 관리자 삭제 기능 확인

**목적**: PUT/DELETE를 POST로 변환한 후 삭제 기능이 정상 작동하는지 확인

**절차**:
1. 메인 타이틀 더블클릭 → 관리자 페이지 진입
2. 목록에서 삭제할 장소 선택
3. 삭제 버튼 클릭
4. 확인 다이얼로그에서 확인 클릭

**예상 결과**:
- 삭제 완료 메시지 표시
- 목록에서 해당 장소가 제거됨
- HTTP 500 에러가 발생하지 않음
- "Method Not Allowed" 에러가 발생하지 않음

**확인 사항**:
- 네트워크 탭에서 DELETE 요청이 POST로 변환되어 전송되는지
- Apps Script 실행 로그에서 "places/{id}" 경로와 "DELETE" method가 정상 처리되는지
- 콘솔에 에러가 없는지

### 테스트 6: 관리자 수정 기능 확인 (UI)

**목적**: 수정 버튼 클릭 시 등록 탭의 STEP2 화면으로 전환되고 기존 데이터가 채워지는지 확인

**절차**:
1. 관리자 페이지 → 수정할 장소 선택
2. 수정 버튼 클릭

**예상 결과**:
- 등록 탭으로 자동 전환됨
- STEP2 화면이 표시됨
- 기존 장소 정보가 폼에 채워짐 (이름, 주소, 태그 등)
- 버튼 텍스트가 "수정 완료하기"로 변경됨
- 지도 미리보기가 표시됨

**확인 사항**:
- 모든 필드가 올바르게 채워지는지
- 태그가 정상적으로 표시되는지
- 지도 미리보기가 표시되는지

### 테스트 7: 관리자 수정 기능 확인 (저장)

**목적**: 수정된 정보가 정상적으로 저장되는지 확인

**절차**:
1. 테스트 6 완료 후
2. 일부 정보 수정 (예: 이름 변경, 태그 추가)
3. 수정 완료하기 버튼 클릭

**예상 결과**:
- 수정 완료 메시지 표시
- 목록에서 수정된 정보가 반영됨
- HTTP 500 에러가 발생하지 않음
- "Method Not Allowed" 에러가 발생하지 않음

**확인 사항**:
- 네트워크 탭에서 PUT 요청이 POST로 변환되어 전송되는지
- Apps Script 실행 로그에서 "places/{id}" 경로와 "PUT" method가 정상 처리되는지
- 수정된 데이터가 Google Sheets에 반영되는지

### 테스트 8: 이미지 수정 기능 확인

**목적**: 기존 이미지가 있는 장소의 이미지를 새 이미지로 교체하는 기능 확인

**절차**:
1. 관리자 페이지 → 이미지가 있는 장소 선택 → 수정
2. 새 이미지 선택
3. 수정 완료하기 버튼 클릭

**예상 결과**:
- 새 이미지가 정상적으로 업로드됨
- 목록에서 새 이미지가 표시됨
- 기존 이미지는 교체됨
- "이미지 업로드에 실패했습니다" 메시지가 표시되지 않음

**확인 사항**:
- 네트워크 탭에서 이미지 업로드 요청이 성공하는지
- `place_id`가 이미지 업로드 요청에 포함되는지
- Apps Script에서 이미지가 정상적으로 업데이트되는지

## 문제 발생 시 확인 사항

### Apps Script 관련 문제
1. GitHub Actions 워크플로우 상태 확인
2. Apps Script 편집기에서 코드 확인
3. Apps Script 실행 로그 확인 (디버깅 메시지 포함)
4. `request.parameter.method` 값 확인

### 백엔드(Render) 관련 문제
1. Render 배포 로그 확인
2. 서버 로그에서 에러 메시지 확인
3. 환경변수 설정 확인 (NAVER_*, NCP_*, TMAP_*)
4. 검색/지오코딩/정적지도 요청만 server.js를 경유하는지 확인

### 프론트엔드 → Apps Script 직접 호출 관련
1. `APPS_SCRIPT_URL`이 배포된 웹앱 URL과 일치하는지 확인
2. `callAppsScript(path, method, body)` 호출 시 path/method가 올바른지 확인

### 프론트엔드 관련 문제
1. 브라우저 콘솔 에러 확인
2. 네트워크 탭에서 실패한 요청 확인 (Apps Script URL vs API_BASE_URL 구분)
3. Vercel 빌드 로그 확인
4. `window.APPS_SCRIPT_URL` / `window.API_BASE_URL` 값 확인

## 성공 기준

모든 테스트에서 다음 조건을 만족해야 함:
- HTTP 에러(500, 405 등)가 발생하지 않음
- 콘솔에 에러 메시지가 없음
- 사용자에게 적절한 피드백 메시지가 표시됨
- 기능이 의도한 대로 작동함
- Apps Script 실행 로그에서 정상적인 경로 처리 확인
